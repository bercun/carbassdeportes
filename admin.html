<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Panel de Administraci√≥n ‚Äî CarbassDeportes</title>
  <link rel="stylesheet" href="styles.css" />
  <script src="mobile-menu.js" defer></script>
</head>
<body>
  <!-- Barra superior sticky para usuario -->
  <div class="user-bar">
    <div class="user-bar-content">
      <div class="user-info hidden">
        <span id="user-name" class="user-name"></span>
      </div>
      <div class="user-actions">
        <a href="admin.html" class="admin-btn active" title="Panel Admin">üõ†Ô∏è</a>
        <a href="#" class="carrito" title="Carrito">üõí</a>
        <button class="btn-logout hidden" id="logout-btn">Salir</button>
        <a href="login.html" class="btn-login hidden" id="login-btn">Iniciar Sesi√≥n</a>
      </div>
    </div>
  </div>

  <div class="site">
    <header class="navbar">
      <div class="brand">
        <img class="logo-svg" src="sours/img/logos/logo_carbass.png" alt="CarbassDeportes Logo" />
        <h1>CarbassDeportes</h1>
      </div>

      <!-- Hamburger menu button (solo visible en m√≥vil) -->
      <button class="hamburger" id="hamburger-btn" aria-label="Abrir men√∫ de navegaci√≥n">
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
      </button>

      <nav class="nav-menu" id="nav-menu">
        <!-- Bot√≥n cerrar (solo visible en m√≥vil cuando el men√∫ est√° abierto) -->
        <button class="nav-close" id="nav-close-btn" aria-label="Cerrar men√∫">‚úï</button>
        
        <ul class="navlinks">
          <li><a href="index.html">Home</a></li>
          <li><a href="catalogo.html">Cat√°logo</a></li>
          <li><a href="admin.html" class="active">Admin</a></li>
        </ul>
      </nav>

      <!-- Overlay para m√≥vil -->
      <div class="nav-overlay" id="nav-overlay"></div>
    </header>

    <main class="layout layout-single-column">
      <div id="access-denied" class="access-denied hidden">
        <h2>‚õî Acceso Denegado</h2>
        <p>No tienes permisos de administrador para acceder a esta p√°gina.</p>
        <a href="index.html" class="btn-login">Volver al inicio</a>
      </div>

      <section id="admin-panel" class="admin-panel hidden">
        <div class="admin-header">
          <h2>üõ†Ô∏è Panel de Administraci√≥n</h2>
          <p>Gestiona productos, usuarios y configuraciones de la tienda</p>
        </div>

        <!-- Estad√≠sticas -->
        <div class="admin-stats">
          <div class="stat-card">
            <div class="stat-number" id="total-productos">0</div>
            <div class="stat-label">Productos</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="total-usuarios">0</div>
            <div class="stat-label">Usuarios</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="total-categorias">4</div>
            <div class="stat-label">Categor√≠as</div>
          </div>
        </div>

        <!-- Tabs -->
        <div class="admin-tabs">
          <button class="tab-btn active" onclick="switchTab('productos')">üì¶ Productos</button>
          <button class="tab-btn" onclick="switchTab('usuarios')">üë• Usuarios</button>
          <button class="tab-btn" onclick="switchTab('ventas')">üí∞ Ventas</button>
          <button class="tab-btn" onclick="switchTab('logs')">üìã Logs</button>
        </div>

        <!-- Tab: Productos -->
        <div id="tab-productos" class="tab-content active">
          <div class="admin-actions">
            <button class="btn-add" onclick="showAddProductModal()">‚ûï Agregar Producto</button>
          </div>

          <div class="products-table-container">
            <table class="admin-table">
              <thead>
                <tr>
                  <th>Imagen</th>
                  <th>Nombre</th>
                  <th>Categor√≠a</th>
                  <th>Precio</th>
                  <th>Stock</th>
                  <th>Estado</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody id="products-table-body">
                <tr>
                  <td colspan="7" style="text-align: center;">Cargando productos...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Tab: Usuarios -->
        <div id="tab-usuarios" class="tab-content">
          <div class="users-table-container">
            <table class="admin-table">
              <thead>
                <tr>
                  <th>Nombre</th>
                  <th>Email</th>
                  <th>Rol</th>
                  <th>Fecha Registro</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody id="users-table-body">
                <tr>
                  <td colspan="5" style="text-align: center;">Cargando usuarios...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Tab: Ventas -->
        <div id="tab-ventas" class="tab-content">
          <!-- Filtros de ventas -->
          <div class="ventas-filters">
            <div class="filter-group">
              <label for="fecha-inicio">Fecha Inicio:</label>
              <input type="date" id="fecha-inicio" />
            </div>
            <div class="filter-group">
              <label for="fecha-fin">Fecha Fin:</label>
              <input type="date" id="fecha-fin" />
            </div>
            <div class="filter-actions">
              <button class="btn-filter" onclick="aplicarFiltrosVentas()">üîç Filtrar</button>
              <button class="btn-clear-filter" onclick="limpiarFiltrosVentas()">üîÑ Limpiar</button>
            </div>
          </div>

          <!-- Estad√≠sticas de ventas -->
          <div class="ventas-stats">
            <div class="stat-card">
              <div class="stat-number" id="total-ventas-count">0</div>
              <div class="stat-label">Total Ventas</div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="total-ventas-monto">$0.00</div>
              <div class="stat-label">Monto Total</div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="promedio-venta">$0.00</div>
              <div class="stat-label">Promedio por Venta</div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="productos-vendidos">0</div>
              <div class="stat-label">Productos Vendidos</div>
            </div>
          </div>

          <!-- Tabla de ventas -->
          <div class="ventas-table-container">
            <table class="admin-table">
              <thead>
                <tr>
                  <th>N¬∫ Venta</th>
                  <th>Fecha</th>
                  <th>Cliente</th>
                  <th>Items</th>
                  <th>Total</th>
                  <th>Estado</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody id="ventas-table-body">
                <tr>
                  <td colspan="7" style="text-align: center;">Cargando ventas...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Tab: Logs -->
        <div id="tab-logs" class="tab-content">
          <!-- Filtros de logs -->
          <div class="ventas-filters">
            <div class="filter-group">
              <label for="log-modulo">M√≥dulo</label>
              <select id="log-modulo">
                <option value="">Todos</option>
                <option value="AUTH">Autenticaci√≥n</option>
                <option value="PRODUCTOS">Productos</option>
                <option value="USUARIOS">Usuarios</option>
                <option value="VENTAS">Ventas</option>
              </select>
            </div>
            
            <div class="filter-group">
              <label for="log-fecha-inicio">Desde</label>
              <input type="date" id="log-fecha-inicio">
            </div>
            
            <div class="filter-group">
              <label for="log-fecha-fin">Hasta</label>
              <input type="date" id="log-fecha-fin">
            </div>
            
            <div class="filter-actions">
              <button class="btn-filter" onclick="aplicarFiltrosLogs()">üîç Filtrar</button>
              <button class="btn-clear-filter" onclick="limpiarFiltrosLogs()">üîÑ Limpiar</button>
            </div>
          </div>

          <!-- Estad√≠sticas de logs -->
          <div class="ventas-stats">
            <div class="stat-card">
              <div class="stat-number" id="total-logs-count">0</div>
              <div class="stat-label">Total Logs</div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="usuarios-activos-logs">0</div>
              <div class="stat-label">Usuarios Activos</div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="dias-actividad">0</div>
              <div class="stat-label">D√≠as con Actividad</div>
            </div>
          </div>

          <!-- Tabla de logs -->
          <div class="ventas-table-container">
            <table class="admin-table">
              <thead>
                <tr>
                  <th>Fecha/Hora</th>
                  <th>Usuario</th>
                  <th>M√≥dulo</th>
                  <th>Acci√≥n</th>
                  <th>Descripci√≥n</th>
                  <th>IP</th>
                </tr>
              </thead>
              <tbody id="logs-table-body">
                <tr>
                  <td colspan="6" style="text-align: center;">Cargando logs...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>
    </main>

    <footer>
      <p>&copy; 2025 CarbassDeportes. Todos los derechos reservados.</p>
    </footer>
  </div>

  <!-- Modal: Agregar/Editar Producto -->
  <div id="product-modal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modal-title">Agregar Producto</h3>
        <button class="modal-close" onclick="closeProductModal()">‚úï</button>
      </div>
      <form id="product-form" class="modal-form">
        <input type="hidden" id="product-id" />
        
        <div class="form-group">
          <label for="product-nombre">Nombre del Producto *</label>
          <input type="text" id="product-nombre" required />
        </div>

        <div class="form-group">
          <label for="product-imagen-file">Imagen del Producto</label>
          <input type="file" id="product-imagen-file" accept="image/*" class="form-control" />
          <small style="color: #666; font-size: 0.85rem;">O ingresa una URL:</small>
          <input type="text" id="product-imagen" placeholder="https://ejemplo.com/imagen.jpg" style="margin-top: 5px;" />
          <div id="imagen-preview" style="margin-top: 10px;"></div>
        </div>

        <div class="form-group">
          <label for="product-descripcion">Descripci√≥n *</label>
          <textarea id="product-descripcion" rows="3" required></textarea>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="product-precio">Precio *</label>
            <input type="number" id="product-precio" step="0.01" min="0" required />
          </div>

          <div class="form-group">
            <label for="product-stock">Stock *</label>
            <input type="number" id="product-stock" min="0" value="1" required />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="product-categoria">Categor√≠a *</label>
            <select id="product-categoria" required>
              <option value="">Seleccionar...</option>
            </select>
          </div>

          <div class="form-group">
            <label for="product-estatus">Estado *</label>
            <select id="product-estatus" required>
              <option value="">Seleccionar...</option>
              <option value="destacado">Destacado</option>
              <option value="oferta">Oferta</option>
              <option value="recien_agregado">Reci√©n Agregado</option>
              <option value="normal">Normal</option>
            </select>
          </div>
        </div>

        <div class="modal-actions">
          <button type="button" class="btn-cancel" onclick="closeProductModal()">Cancelar</button>
          <button type="submit" class="btn-save" id="btn-save-product">Guardar Producto</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal: Detalle de Venta -->
  <div id="venta-modal" class="modal hidden">
    <div class="modal-content modal-large">
      <div class="modal-header">
        <h3>üìÑ Detalle de Venta</h3>
        <button class="modal-close" onclick="closeVentaModal()">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="venta-info">
          <div class="info-row">
            <div class="info-col">
              <strong>N√∫mero de Venta:</strong>
              <span id="venta-numero"></span>
            </div>
            <div class="info-col">
              <strong>Fecha:</strong>
              <span id="venta-fecha"></span>
            </div>
            <div class="info-col">
              <strong>Estado:</strong>
              <span id="venta-estado" class="badge"></span>
            </div>
          </div>
          
          <div class="info-section">
            <h4>Datos del Cliente</h4>
            <div class="info-row">
              <div class="info-col">
                <strong>Nombre:</strong>
                <span id="venta-cliente-nombre"></span>
              </div>
              <div class="info-col">
                <strong>Email:</strong>
                <span id="venta-cliente-email"></span>
              </div>
            </div>
            <div class="info-row">
              <div class="info-col">
                <strong>Tel√©fono:</strong>
                <span id="venta-cliente-telefono"></span>
              </div>
              <div class="info-col">
                <strong>Direcci√≥n:</strong>
                <span id="venta-cliente-direccion"></span>
              </div>
            </div>
            <div class="info-row" id="venta-observaciones-row">
              <div class="info-col full-width">
                <strong>Observaciones:</strong>
                <span id="venta-observaciones"></span>
              </div>
            </div>
          </div>

          <div class="info-section">
            <h4>Productos</h4>
            <table class="admin-table">
              <thead>
                <tr>
                  <th>Producto</th>
                  <th>Cantidad</th>
                  <th>Precio Unit.</th>
                  <th>Subtotal</th>
                </tr>
              </thead>
              <tbody id="venta-items"></tbody>
            </table>
          </div>

          <div class="info-section">
            <div class="venta-totales">
              <div class="total-row">
                <span>Subtotal:</span>
                <strong id="venta-subtotal">$0.00</strong>
              </div>
              <div class="total-row">
                <span>IVA (22%):</span>
                <strong id="venta-iva">$0.00</strong>
              </div>
              <div class="total-row total-final">
                <span>TOTAL:</span>
                <strong id="venta-total">$0.00</strong>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-actions">
        <button class="btn-cancel" onclick="closeVentaModal()">Cerrar</button>
        <button class="btn-save" onclick="imprimirVenta()">üñ®Ô∏è Imprimir</button>
      </div>
    </div>
  </div>

  <!-- Firebase (comentado - ahora usando PHP/MySQL) -->
  <!--
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="firebase-config.js"></script>
  <script src="auth-check.js"></script>
  -->
  
  <!-- Versi√≥n PHP -->
  <script src="auth-check-php.js"></script>
  <script src="admin.js"></script>
</body>
</html>
