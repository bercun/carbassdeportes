<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Simple - CarbassDeportes</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .section { margin: 30px 0; padding: 20px; border: 2px solid #ddd; border-radius: 8px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .card { border: 1px solid #ccc; border-radius: 8px; padding: 15px; background: #f9f9f9; }
        .loading { color: #666; text-align: center; padding: 20px; }
        .error { color: red; text-align: center; padding: 20px; }
        .success { color: green; text-align: center; padding: 20px; }
        #log { background: #000; color: #0f0; padding: 10px; font-family: monospace; font-size: 12px; height: 200px; overflow-y: auto; margin-top: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Test Simple - CarbassDeportes</h1>
        
        <div id="status" class="loading">Inicializando...</div>
        
        <div class="section">
            <h2>Art√≠culos Destacados</h2>
            <div class="grid" id="destacados-container">
                <p class="loading">Cargando destacados...</p>
            </div>
        </div>

        <div class="section">
            <h2>Reci√©n Agregados</h2>
            <div class="grid" id="recientes-container">
                <p class="loading">Cargando recientes...</p>
            </div>
        </div>

        <div class="section">
            <h2>Ofertas</h2>
            <div class="grid" id="ofertas-container">
                <p class="loading">Cargando ofertas...</p>
            </div>
        </div>

        <div class="section">
            <h2>Coleccionables</h2>
            <div class="grid" id="coleccionables-container">
                <p class="loading">Cargando coleccionables...</p>
            </div>
        </div>

        <div id="log"></div>
    </div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="firebase-config.js"></script>

    <script>
        let db;
        const logEl = document.getElementById('log');
        const statusEl = document.getElementById('status');

        function log(message) {
            console.log(message);
            logEl.innerHTML += message + '\n';
            logEl.scrollTop = logEl.scrollHeight;
        }

        function updateStatus(message, type = 'loading') {
            statusEl.textContent = message;
            statusEl.className = type;
        }

        // Inicializar Firebase
        function initFirebase() {
            try {
                if (typeof firebase === 'undefined') {
                    throw new Error('Firebase no est√° cargado');
                }
                
                db = firebase.firestore();
                log('‚úÖ Firebase inicializado correctamente');
                return true;
            } catch (error) {
                log('‚ùå Error inicializando Firebase: ' + error.message);
                return false;
            }
        }

        // Funci√≥n simple para crear HTML de producto
        function createProductHtml(product) {
            const precio = typeof product.precio === 'number' ? product.precio : parseFloat(product.precio) || 0;
            return `
                <div class="card">
                    <h4>${product.nombre}</h4>
                    <p>${product.descripci√≥n || 'Sin descripci√≥n'}</p>
                    <p><strong>Precio: $${precio.toFixed(2)}</strong></p>
                    <p><small>Categor√≠a: ${product.categoria || 'No especificada'}</small></p>
                    <p><small>Estatus: ${product.estatus || 'No especificado'}</small></p>
                </div>
            `;
        }

        // Renderizar productos en un contenedor
        function renderProducts(container, products, sectionName) {
            if (!container) {
                log(`‚ùå Contenedor no encontrado para ${sectionName}`);
                return;
            }

            if (!products || products.length === 0) {
                container.innerHTML = `<p>No hay productos en ${sectionName}</p>`;
                log(`üì≠ No hay productos para ${sectionName}`);
                return;
            }

            let html = '';
            products.forEach(product => {
                html += createProductHtml(product);
            });

            container.innerHTML = html;
            log(`‚úÖ ${products.length} productos renderizados en ${sectionName}`);
        }

        // Cargar y mostrar productos
        function loadProducts() {
            if (!initFirebase()) {
                updateStatus('Error: Firebase no disponible', 'error');
                return;
            }

            updateStatus('Conectando a la base de datos...', 'loading');
            log('üîÑ Iniciando carga de productos...');

            db.collection('articulos').get()
                .then((snapshot) => {
                    log(`‚úÖ Conexi√≥n exitosa. Documentos encontrados: ${snapshot.size}`);
                    
                    if (snapshot.empty) {
                        updateStatus('No hay productos en la base de datos', 'error');
                        log('‚ö†Ô∏è La colecci√≥n est√° vac√≠a');
                        return;
                    }

                    // Convertir documentos a array
                    const allProducts = snapshot.docs.map(doc => {
                        const data = doc.data();
                        log(`üì¶ Producto: ${data.nombre} (${data.categoria}/${data.estatus})`);
                        return { id: doc.id, ...data };
                    });

                    log(`üìä Total productos cargados: ${allProducts.length}`);
                    updateStatus(`${allProducts.length} productos cargados exitosamente`, 'success');

                    // Filtrar por secci√≥n
                    const destacados = allProducts.filter(p => p.estatus && p.estatus.toLowerCase() === 'destacado');
                    const recientes = allProducts.filter(p => p.estatus && p.estatus.toLowerCase() === 'recien agregado');
                    const ofertas = allProducts.filter(p => p.estatus && p.estatus.toLowerCase() === 'oferta');
                    const coleccionables = allProducts.filter(p => p.categoria && p.categoria.toLowerCase() === 'coleccionables');

                    log(`üìà Filtrado:`);
                    log(`- Destacados: ${destacados.length}`);
                    log(`- Recientes: ${recientes.length}`);
                    log(`- Ofertas: ${ofertas.length}`);
                    log(`- Coleccionables: ${coleccionables.length}`);

                    // Renderizar cada secci√≥n
                    renderProducts(document.getElementById('destacados-container'), destacados, 'Destacados');
                    renderProducts(document.getElementById('recientes-container'), recientes, 'Recientes');
                    renderProducts(document.getElementById('ofertas-container'), ofertas, 'Ofertas');
                    renderProducts(document.getElementById('coleccionables-container'), coleccionables, 'Coleccionables');

                    log('üéâ Proceso completado exitosamente');
                })
                .catch((error) => {
                    log('‚ùå Error cargando productos: ' + error.message);
                    updateStatus('Error cargando productos', 'error');
                });
        }

        // Iniciar cuando el DOM est√© listo
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', loadProducts);
        } else {
            loadProducts();
        }
    </script>
</body>
</html>